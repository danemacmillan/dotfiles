# vim: ft=sh

##
# .bash_completion
#
# This includes third-party bash completion scripts, and custom ones.
#
# @author Dane MacMillan <work@danemacmillan.com>
# @link https://github.com/danemacmillan/dotfiles
# @license MIT

##
# Third party bash completion.

# Source google-cloud-sdk gcloud utilities
# https://cloud.google.com/sdk/docs/quickstarts
if [[ -f "/usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/completion.bash.inc" ]]; then
	source /usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/completion.bash.inc
fi

##
# Completion for proprietary Linus Shops CLI tool.
#
# @author Dane MacMillan <work@danemacmillan.com>
#
if command_exists linus; then
	eval $(linus _completion -g -p linus)

	if php -m |grep -q xdebug; then
		eval $(linus _completion -g -p linusdebug)
	fi
fi

##
# Include custom bash_completion content here.

##
# Autocompletion for https://github.com/netz98/n98-magerun
_n98-magerun()
{
    local cur opts cmd commandlist
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    cmd="${COMP_WORDS[0]}"

    # gets the word-to-complete without (-n) considering ":" as word breaks
    _get_comp_words_by_ref -n : cur

    # workaround for php bug
    commandlist=$(echo "" | "$cmd" --raw --no-ansi list)

    # regex to remove command help, wrtie everything on one line with space separated
    opts=$(echo "$commandlist" | sed "s/\s.*//g" | paste -sd " ")

    COMPREPLY=( $(compgen -W "${opts}" -- "${cur}") )

    # removes colon containing prefix from COMPREPLY items
    __ltrim_colon_completions "$cur"
    return 0
}
complete -F _n98-magerun n98-magerun.phar
complete -F _n98-magerun n98-magerun
complete -F _n98-magerun magerun

##
# Custom completion for vshell command.
#
# The vshell command is part of the VagrantShell repo located at
# https://github.com/danemacmillan/vagrantshell
#
# @author Dane MacMillan <work@danemacmillan.com>
#
_vshell()
{
	local cur prev opts
	COMPREPLY=()
	cur="${COMP_WORDS[COMP_CWORD]}"
	prev="${COMP_WORDS[COMP_CWORD-1]}"
	opts="help map restart update xdebug xhprof"

	if [[ ${cur} == * ]] ; then
		COMPREPLY=( $(compgen -W "${opts}" -- ${cur}) )
		return 0
	fi
}
complete -F _vshell vshell
